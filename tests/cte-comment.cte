c0
// ======================
// CTE comment test cases
// ======================
{
    "options" = {
        "failFast" = false  // If true, halt tests on first error
    }

    "cteTests" = [

        // ====================================================================

        {
            "name" = "Comment basic structure"
            "encodeDecode" = [
                {
                    "events" = ["v 0" "com false " "n 1"]
                    "document" = "\.^
c0
//
1^"
                }
                {
                    "events" = ["v 0" "com false test" "n 1"]
                    "document" = "\.^
c0
//test
1^"
                }
                {
                    "events" = ["v 0" "com false  test" "n 1"]
                    "document" = "\.^
c0
// test
1^"
                }
                {
                    "events" = ["v 0" "com false  test " "n 1"]
                    "document" = "\.^
c0
// test 
1^"
                }
                {
                    "events" = ["v 0" "com false  /* test */" "n 1"]
                    "document" = "\.^
c0
// /* test */
1^"
                }
                {
                    "events" = ["v 0" "com true " "n 1"]
                    "document" = "\.^
c0
/**/
1^"
                }
                {
                    "events" = ["v 0" "com true test" "n 1"]
                    "document" = "\.^
c0
/*test*/
1^"
                }
                {
                    "events" = ["v 0" "com true  test " "n 1"]
                    "document" = "\.^
c0
/* test */
1^"
                }
                {
                    "events" = ["v 0" "com true  test\nmultiline" "n 1"]
                    "document" = "\.^
c0
/* test
multiline*/
1^"
                }
                {
                    "events" = ["v 0" "com true  test /* nested */ " "n 1"]
                    "document" = "\.^
c0
/* test /* nested */ */
1^"
                }
                {
                    "events" = ["v 0" "com true /**/" "n 1"]
                    "document" = "\.^
c0
/*/**/*/
1^"
                }
                {
                    "events" = ["v 0" "com true /*/**/*/" "n 1"]
                    "document" = "\.^
c0
/*/*/**/*/*/
1^"
                }
                {
                    "events" = ["v 0" "com true  a /* b /* c */ d */ e " "n 1"]
                    "document" = "\.^
c0
/* a /* b /* c */ d */ e */
1^"
                }
                {
                    "events" = ["v 0" "com true  test // nested " "n 1"]
                    "document" = "\.^
c0
/* test // nested */
1^"
                }
                {
                    "events" = ["v 0" "com true  test\n/* nested */\n" "n 1"]
                    "document" = "\.^
c0
/* test
/* nested */
*/
1^"
                }
                {
                    "events" = ["v 0" "com true  test\n// nested\n" "n 1"]
                    "document" = "\.^
c0
/* test
// nested
*/
1^"
                }
            ]
            "decodeEncode" = [
                {"document"="c0 //\r\n1"  "events"=["v 0" "com false " "n 1"]}
                {"document"="c0 // \r\n1"  "events"=["v 0" "com false  " "n 1"]}
                {"document"="c0 // test\r\n1"  "events"=["v 0" "com false  test" "n 1"]}
                {
                    "document" = "\.^
c0
/* x */1^"
                    "events" = ["v 0" "com true  x " "n 1"]
                }
                {
                    "document" = "\.^
c0
/* x */ 1^"
                    "events" = ["v 0" "com true  x " "n 1"]
                }
            ]
            "decodeFail" = [
                "c0 //"             // No content
                "c0 /*"             // Unterminated
                "c0 /**"            // Unterminated
                "c0 /*/"            // Unterminated
                "c0 /*/**/"         // Unterminated
                "c0 /* /* */"       // Unterminated
                "c0 /* /* /* */ */" // Unterminated
                "c0 1//"            // Comment after TLO
                "c0 1/**/"          // Comment after TLO
            ]
        }

        // ====================================================================

        {
            "name" = "Comment positioning (list)"
            "encodeDecode" = [
                {
                    "events" = ["v 0" "l" "com false  x" "e"]
                    "document" = "\.^
c0
[
    // x
]^"
                }
                {
                    "events" = ["v 0" "l" "com true  x " "e"]
                    "document" = "\.^
c0
[
    /* x */
]^"
                }
                {
                    "events" = ["v 0" "l" "com false  x" "s abc" "e"]
                    "document" = "\.^
c0
[
    // x
    "abc"
]^"
                }
                {
                    "events" = ["v 0" "l" "com true  x " "s abc" "e"]
                    "document" = "\.^
c0
[
    /* x */
    "abc"
]^"
                }
                {
                    "events" = ["v 0" "l" "s abc" "com false  x" "e"]
                    "document" = "\.^
c0
[
    "abc"
    // x
]^"
                }
                {
                    "events" = ["v 0" "l" "s abc" "com true  x " "e"]
                    "document" = "\.^
c0
[
    "abc"
    /* x */
]^"
                }
            ]
            "decodeEncode" = [
/* TODO: Allow "abc"// x
                {
                    "document" = "\.^
c0
[
    "abc"// x
]^"
                    "events" = ["v 0" "l" "s abc" "com false  x" "e"]
                }
*/
                {
                    "document" = "\.^
c0
[
    "abc" // x
]^"
                    "events" = ["v 0" "l" "s abc" "com false  x" "e"]
                }
                {
                    "document" = "\.^
c0
[
    "abc" /* x */
]^"
                    "events" = ["v 0" "l" "s abc" "com true  x " "e"]
                }
/* TODO: Allow "abc"/* x */
                {
                    "document" = "\.^
c0
[
    "abc"/* x */
]^"
                    "events" = ["v 0" "l" "s abc" "com true  x " "e"]
                }
*/
                {
                    "document" = "\.^
c0
[
    /* x */ "abc"
]^"
                    "events" = ["v 0" "l" "com true  x " "s abc" "e"]
                }
            ]
        }

        // ====================================================================

        {
            "name" = "Comment positioning (map)"
            "encodeDecode" = [
                {
                    "events" = ["v 0" "m" "com false  x" "e"]
                    "document" = "\.^
c0
{
    // x
}^"
                }
                {
                    "events" = ["v 0" "m" "com true  x " "e"]
                    "document" = "\.^
c0
{
    /* x */
}^"
                }
                {
                    "events" = ["v 0" "m" "com false  x" "s abc" "n 1" "e"]
                    "document" = "\.^
c0
{
    // x
    "abc" = 1
}^"
                }
                {
                    "events" = ["v 0" "m" "com true  x " "s abc" "n 1" "e"]
                    "document" = "\.^
c0
{
    /* x */
    "abc" = 1
}^"
                }
                {
                    "events" = ["v 0" "m" "s abc" "n 1" "com false  x" "e"]
                    "document" = "\.^
c0
{
    "abc" = 1
    // x
}^"
                }
                {
                    "events" = ["v 0" "m" "s abc" "n 1" "com true  x " "e"]
                    "document" = "\.^
c0
{
    "abc" = 1
    /* x */
}^"
                }
                {
                    "events" = ["v 0" "m" "s abc" "com false  x" "n 1" "e"]
                    "document" = "\.^
c0
{
    "abc" = // x
    1
}^"
                }
                {
                    "events" = ["v 0" "m" "s abc" "com true  x " "n 1" "e"]
                    "document" = "\.^
c0
{
    "abc" = /* x */
    1
}^"
                }
            ]
            "decodeEncode" = [
/* TODO: Allow "abc"// x
                {
                    "document" = "\.^
c0
{
    "abc"// x
    = 1
}^"
                    "events" = ["v 0" "m" "s abc" "com false  x" "n 1" "e"]
                }
*/
/* TODO: Allow comment between key and value
                {
                    "document" = "\.^
c0
{
    "abc" // x
    = 1
}^"
                    "events" = ["v 0" "m" "s abc" "com false  x" "n 1" "e"]
                }
*/
                {
                    "document" = "\.^
c0
{
    "abc" = // x
    1
}^"
                    "events" = ["v 0" "m" "s abc" "com false  x" "n 1" "e"]
                }
/* TODO: Allow comment between key and value
                {
                    "document" = "\.^
c0
{
    "abc" /* x */
    = 1
}^"
                    "events" = ["v 0" "m" "s abc" "com true  x " "n 1" "e"]
                }
*/
                {
                    "document" = "\.^
c0
{
    "abc" = /* x */
    1
}^"
                    "events" = ["v 0" "m" "s abc" "com true  x " "n 1" "e"]
                }
/* TODO: Allow "abc"/* x */
                {
                    "document" = "\.^
c0
{
    "abc"/* x */
    = 1
}^"
                    "events" = ["v 0" "m" "s abc" "com true  x " "n 1" "e"]
                }
*/
                {
                    "document" = "\.^
c0
{
    /* x */ "abc" = 1
}^"
                    "events" = ["v 0" "m" "com true  x " "s abc" "n 1" "e"]
                }
            ]
        }

        // ====================================================================

        {
            "name" = "Comment positioning (edge)"
            "encodeDecode" = [
                {
                    "events" = ["v 0" "l" "edge" "com false  x" "n 1" "n 2" "n 3" "e"]
                    "document" = "\.^
c0
[
    @(// x
        1 2 3)
]^"
                }
                {
                    "events" = ["v 0" "l" "edge" "com true  x " "n 1" "n 2" "n 3" "e"]
                    "document" = "\.^
c0
[
    @(/* x */
        1 2 3)
]^"
                }
                {
                    "events" = ["v 0" "l" "edge" "n 1" "com false  x" "n 2" "n 3" "e"]
                    "document" = "\.^
c0
[
    @(1 // x
        2 3)
]^"
                }
                {
                    "events" = ["v 0" "l" "edge" "n 1" "com true  x " "n 2" "n 3" "e"]
                    "document" = "\.^
c0
[
    @(1 /* x */
        2 3)
]^"
                }
                {
                    "events" = ["v 0" "l" "edge" "n 1" "n 2" "com false  x" "n 3" "e"]
                    "document" = "\.^
c0
[
    @(1 2 // x
        3)
]^"
                }
                {
                    "events" = ["v 0" "l" "edge" "n 1" "n 2" "com true  x " "n 3" "e"]
                    "document" = "\.^
c0
[
    @(1 2 /* x */
        3)
]^"
                }
            ]
        }

        // ====================================================================

        {
            "name" = "Comment positioning (node)"
            "encodeDecode" = [
                {
                    "events" = ["v 0" "l" "node" "com false  x" "n 1" "e" "e"]
                    "document" = "\.^
c0
[
    (// x
        1
    )
]^"
                }
                {
                    "events" = ["v 0" "l" "node" "n 1" "com false  x" "e" "e"]
                    "document" = "\.^
c0
[
    (1
        // x
    )
]^"
                }
                {
                    "events" = ["v 0" "l" "node" "n 1" "com false  x" "n 2" "n 3" "e" "e"]
                    "document" = "\.^
c0
[
    (1
        // x
        2
        3
    )
]^"
                }
                {
                    "events" = ["v 0" "l" "node" "n 1" "n 2" "com false  x" "n 3" "e" "e"]
                    "document" = "\.^
c0
[
    (1
        2
        // x
        3
    )
]^"
                }
            ]
        }

        // ====================================================================

        {
            "name" = "Complex comment"
            "encodeDecode" = [
                {
                    "events" = ["v 0" "com true "
                                    "m"
                                        "com true "
                                        "s a" "com true " "s b"
                                        "com true "
                                    "e"]
                    "document" = "\.^
c0
/**/
{
    /**/
    "a" = /**/
    "b"
    /**/
}^"
                }
            ]
        }

        // ====================================================================

    ]
}
